<%- include("../layout/header"); %>
<%- include("../layout/sidebar"); %>

<section class="content">
        <div class="container-fluid">
            <div class="block-header">
                
            </div>
            
            <!-- Exportable Table -->
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="card">
                        <div class="header">
                            <h2>
                                Users List
                            </h2>
                            
                        </div>
                        <div class="body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped table-condensed table-hover dataTable js-exportable ">
                                    <thead>
                                        <tr>
                                            <th>Sr. No.</th>
                                            <th>Name</th>
                                            <th>Mobile</th>
                                            <th>Email</th>
                                            <th>Gender</th>
                                            <th>Date Of Birth</th>
                                            <th>Age</th>
                                            <th>Profile Image</th>
                                            <th>Wallet</th>
                                            <th>Verify Status</th>
                                            <th>Active Status</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Sr. No.</th>
                                            <th>Name</th>
                                            <th>Mobile</th>
                                            <th>Email</th>
                                            <th>Gender</th>
                                            <th>Date Of Birth</th>
                                            <th>Age</th>
                                            <th>Profile Image</th>
                                            <th>Wallet</th>
                                            <th>Verify Status</th>
                                            <th>Active Status</th>
                                        </tr>
                                    </tfoot>
                                    <tbody>
                                        <% var i=1;data.forEach(function(datas){ %>
                                            <tr>
                                                <td style="width:100px"><%= i %></td>
                                                <td style="width:100px"><%= datas.name %></td>
                                                <td style="width:100px"><%= datas.mobile %></td>
                                                <td style="width:100px"><%= datas.email %></td>
                                                <td style="width:100px"><%= datas.genders %></td>
                                                <td style="width:100px"><%= datas.dob %></td>
                                                <td style="width:100px"><%= datas.age %></td>
                                                <td style="width:100px"><img src="<%= datas.images %>" height="100px" width="100px"></td>
                                                <td style="width:100px">
                                                    <div class="icon">
                                                        <i class="material-icons" style="font-size:25px;color:blue" data-toggle="modal" data-target="#smallModal" data-id="<%= datas.id %>" data-wallet="<%= datas.wallet %>" data-winning_wallet="<%= datas.winning_wallet %>" data-unutiliesed_wallet="<%= datas.unutiliesed_wallet %>" data-bonus_wallet="<%= datas.bonus_wallet %>"  data-name="<%= datas.name %>">account_balance_wallet</i>
                                                    </div>
                                                </td>
                                                <td style="width:100px"><%= datas.verify_status %></td>
                                                <td style="width:100px"><%= datas.active_status %></td>
                                            </tr>
                                        <% i++;}); %>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- #END# Exportable Table -->
        </div>
        
        <div class="modal fade" id="smallModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    </div>
                    
                    <div class="modal-body">
                        
                        <div class="form-group form-float">
                            <u><h4 id="name"></h4></u>
                            <div class="row">
                                <div class="col-sm-7">
                                    <label>Current Balance :</label>
                                </div>
                                
                                <div class="col-sm-5">
                                    ₹ <span id="wallet"></span><br>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-7">
                                    <label>Added Amount :</label>
                                </div>
                                
                                <div class="col-sm-5">
                                    ₹ <span id="unutiliesed_wallet"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-7">
                                    <label>Winnings :</label>
                                </div>
                                
                                <div class="col-sm-5">
                                    ₹ <span id="winning_wallet"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-7">
                                    <label>Cash Bonus :</label>
                                </div>
                                
                                <div class="col-sm-5">
                                    ₹ <span id="bonus_wallet"></span>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="form-group form-float">
                            <div class="form-line">
                                <form id="walletForm">
                                    <label>Add Amount :</label>
                                    <input type="hidden" class="form-control" id="userid" name="userid" id="id" required>
                                    <div class="row">
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="amount" name="wallet" required>
                                        </div>
                                        <div class="col-sm-4">
                                            <button class="btn btn-primary waves-effect" type="submit">SUBMIT</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                        
                    </div>
                    
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
<script>
   
   $(document).ready(function(){
       $('[data-toggle="modal"]').on('click', function () {
           var id = $(this).data('id');
            var wallet = $(this).data('wallet');
            console.log(wallet);
            var winning_wallet = $(this).data('winning_wallet');
            var unutiliesed_wallet = $(this).data('unutiliesed_wallet');
            var bonus_wallet = $(this).data('bonus_wallet');
            var name = $(this).data('name');
           var modal = $('#smallModal');


           modal.find('#userid').val(id);
           modal.find('#wallet').text(wallet);
           modal.find('#winning_wallet').text(winning_wallet);
           modal.find('#unutiliesed_wallet').text(unutiliesed_wallet);
           modal.find('#bonus_wallet').text(bonus_wallet);
           modal.find('#name').text(name);
       });
   });
</script>
<script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('walletForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Get values from the input fields
                const useridInput = document.getElementById('userid');
                const amountInput = document.getElementById('amount');

                // Check if elements exist before accessing their value
                if (useridInput && amountInput) {
                    const userid = useridInput.value;
                    const amount = amountInput.value;

                    console.log('User ID:', userid); // Debugging log
                    console.log('Amount:', amount); // Debugging log
                    
                    console.log(JSON.stringify({ userid, amount }));
                    try {
                        const response = await fetch('/prodsite/user/add_wallet', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ userid, amount })
                        });

                        const result = await response.json();

                        console.log('API Response:', result); // Debugging log

                        if (result.status === '200') {
                            alert(result.msg);
                            window.location.reload();
                            window.location.href = '';
                        } else if (result.status === '400') {
                            alert(result.msg);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('An unexpected error occurred. Please try again.');
                    }
                } else {
                    alert('Input fields not found.');
                }
            });
        });
    </script>
</body>
<%- include("../layout/datatable"); %>
